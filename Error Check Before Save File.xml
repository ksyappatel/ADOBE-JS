<?xml version="1.0" encoding="UTF-8"?>
<Commands>
	<Command name="JavaScript" pauseBefore="false" promptUser="false" label="Error Check Before Save File" tooltip="Error Check Before Save File (Inactive Bookmark And Clsoe Bookmarks " ID="5e008f4d9670419f9421192aa62cb68">
		<Items>
			<Item name="ScriptCode" type="text" value="// Function to check for inactive bookmarks and track their paths&#xD;&#xA;function checkBookmarks(bookmarksList, currentPath) {&#xD;&#xA;    var inactiveBookmarks = [];&#xD;&#xA;    var inactiveSubBookmarks = [];&#xD;&#xA;&#xD;&#xA;    for (var i = 0; i &lt; bookmarksList.length; i++) {&#xD;&#xA;        var bookmark = bookmarksList[i];&#xD;&#xA;        var originalPage = this.pageNum; // Store the original page number&#xD;&#xA;        var bookmarkPath = currentPath + &quot; &gt; &quot; + bookmark.name; // Construct the path&#xD;&#xA;&#xD;&#xA;        // Attempt to execute the bookmark&#xD;&#xA;        try {&#xD;&#xA;            bookmark.execute();&#xD;&#xA;            // Check if the page has changed after execution&#xD;&#xA;            if (this.pageNum === originalPage) {&#xD;&#xA;                inactiveBookmarks.push(bookmarkPath); // Add to inactive bookmarks list with path&#xD;&#xA;            }&#xD;&#xA;        } catch (e) {&#xD;&#xA;            // If execution fails, consider the bookmark inactive&#xD;&#xA;            inactiveBookmarks.push(bookmarkPath);&#xD;&#xA;        }&#xD;&#xA;&#xD;&#xA;        // Reset to the original page&#xD;&#xA;        this.pageNum = originalPage;&#xD;&#xA;&#xD;&#xA;        // Check for sub-bookmarks recursively&#xD;&#xA;        if (bookmark.children &amp;&amp; bookmark.children.length &gt; 0) {&#xD;&#xA;            var subResult = checkBookmarks(bookmark.children, bookmarkPath);&#xD;&#xA;            inactiveSubBookmarks = inactiveSubBookmarks.concat(subResult.inactiveBookmarks);&#xD;&#xA;            inactiveSubBookmarks = inactiveSubBookmarks.concat(subResult.inactiveSubBookmarks);&#xD;&#xA;        }&#xD;&#xA;    }&#xD;&#xA;&#xD;&#xA;    // Return both inactive bookmarks and sub-bookmarks&#xD;&#xA;    return {&#xD;&#xA;        inactiveBookmarks: inactiveBookmarks,&#xD;&#xA;        inactiveSubBookmarks: inactiveSubBookmarks&#xD;&#xA;    };&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;// Function to close sub-bookmarks in the PDF&#xD;&#xA;function closeSubBookmarks() {&#xD;&#xA;    // Get the root of the bookmark tree&#xD;&#xA;    var root = this.bookmarkRoot;&#xD;&#xA;    &#xD;&#xA;    // Check if the root exists&#xD;&#xA;    if (root) {&#xD;&#xA;        // Recursive function to close sub-bookmarks&#xD;&#xA;        function closeBookmarks(bookmark) {&#xD;&#xA;            // Check if the bookmark has children&#xD;&#xA;            if (bookmark.children) {&#xD;&#xA;                // Iterate through all children of the current bookmark&#xD;&#xA;                for (var i = 0; i &lt; bookmark.children.length; i++) {&#xD;&#xA;                    // Close each child bookmark&#xD;&#xA;                    bookmark.children[i].open = false;&#xD;&#xA;                    &#xD;&#xA;                    // Recursively close sub-bookmarks of each child&#xD;&#xA;                    closeBookmarks(bookmark.children[i]);&#xD;&#xA;                }&#xD;&#xA;            }&#xD;&#xA;        }&#xD;&#xA;        &#xD;&#xA;        // Start closing sub-bookmarks from the root&#xD;&#xA;        closeBookmarks(root);&#xD;&#xA;    } else {&#xD;&#xA;        console.log(&quot;No bookmarks found in the document.&quot;);&#xD;&#xA;    }&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;// Main function to perform error check before saving the file&#xD;&#xA;function errorCheckBeforeSaveFile() {&#xD;&#xA;    // Get the root bookmarks and check for inactive ones&#xD;&#xA;    var myBookmarksList = this.bookmarkRoot.children;&#xD;&#xA;    var result = checkBookmarks(myBookmarksList, &quot;Root&quot;);&#xD;&#xA;&#xD;&#xA;    // Prepare the message for the alert&#xD;&#xA;    var totalInactive = result.inactiveBookmarks.length + result.inactiveSubBookmarks.length;&#xD;&#xA;    var message = &quot;Total Inactive Bookmarks: &quot; + totalInactive + &quot;\n\n&quot;;&#xD;&#xA;&#xD;&#xA;    if (result.inactiveBookmarks.length &gt; 0) {&#xD;&#xA;        message += &quot;Main Inactive Bookmarks:\n&quot; + result.inactiveBookmarks.join(&quot;\n&quot;) + &quot;\n\n&quot;;&#xD;&#xA;    } else {&#xD;&#xA;        message += &quot;No main inactive bookmarks found.\n\n&quot;;&#xD;&#xA;    }&#xD;&#xA;&#xD;&#xA;    if (result.inactiveSubBookmarks.length &gt; 0) {&#xD;&#xA;        message += &quot;Sub Inactive Bookmarks:\n&quot; + result.inactiveSubBookmarks.join(&quot;\n&quot;);&#xD;&#xA;    } else {&#xD;&#xA;        message += &quot;No sub inactive bookmarks found.&quot;;&#xD;&#xA;    }&#xD;&#xA;&#xD;&#xA;    // Display the alert message&#xD;&#xA;    app.alert(message, 3);&#xD;&#xA;&#xD;&#xA;    // Only close sub-bookmarks if no inactive bookmarks are found&#xD;&#xA;    if (totalInactive === 0) {&#xD;&#xA;        closeSubBookmarks();&#xD;&#xA;    }&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;// Execute the main function&#xD;&#xA;errorCheckBeforeSaveFile();"/>
		</Items>
	</Command>
</Commands>
